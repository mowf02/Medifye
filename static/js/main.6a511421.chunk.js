(this.webpackJsonpmedifye=this.webpackJsonpmedifye||[]).push([[0],{30:function(e,t,a){e.exports=a.p+"static/media/header-small.9748ff27.png"},31:function(e,t,a){e.exports=a.p+"static/media/header-large.0bc5fa64.png"},32:function(e,t,a){e.exports=a.p+"static/media/loader.285f3251.gif"},34:function(e,t,a){e.exports=a(65)},40:function(e,t,a){},41:function(e,t,a){},64:function(e,t,a){},65:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(28),s=a.n(i),o=(a(39),a(40),a(5)),c=a(6),l=a(10),u=a(9),p=(a(41),window.location.hash.substring(1).split("&").reduce((function(e,t){if(t){var a=t.split("=");e[a[0]]=decodeURIComponent(a[1])}return e}),{})),m="".concat("https://accounts.spotify.com/authorize","?client_id=").concat("8d699747d5674a67a0dd1ea68e7123f1","&redirect_uri=").concat("http://localhost:3000/","&scope=").concat(["playlist-read-private","user-top-read","user-read-recently-played","playlist-modify-private","playlist-modify-public"].join("%20"),"&response_type=token&show_dialog=true"),d=a(33),h=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this;return this.props.isLoggedIn?null:r.a.createElement("div",null,r.a.createElement(d.a,{className:"button-primary",variant:"success",onClick:function(){return e.props.handleLogin()}},"Login with Spotify"))}}]),a}(r.a.Component),f=a(16),y=a(14),v=a(11),g=a.n(v);var k=function(e){return e.isLoggedIn?null:r.a.createElement(y.a,null,r.a.createElement(f.a,{className:"d-flex align-items-center flex-column login justify-content-center login"},r.a.createElement(g.a,{duration:2e3},r.a.createElement("header",null," Medify "),r.a.createElement(g.a,{delay:1e3},r.a.createElement(h,{isLoggedIn:e.isLoggedIn,handleLogin:function(){return e.handleLogin()}})),r.a.createElement("h4",{className:"mt-5"},"Get more danceable, more medieval recommendations."),r.a.createElement("h6",{className:"mt-5"}," ","Created by"," ",r.a.createElement("a",{href:"http://lizmowforth.com/",target:"_blank",rel:"noopener noreferrer"}," ","Liz Mowforth"," ")," "),r.a.createElement(g.a,{delay:2e3},r.a.createElement("h6",null,"Powered by"," ",r.a.createElement("a",{href:"https://developer.spotify.com/documentation/web-api/",target:"_blank ",rel:"noopener noreferrer"}," ","Spotify's API."," ")," ")))))},b=a(1),E=a.n(b),w=a(7),x=a(8),I=a(2),j=a.n(I),T=a(30),L=a.n(T),O=a(31),C=a.n(O),N=(a(64),function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={isPlaying:!1,isHovering:!1},n.handleMouseHover=n.handleMouseHover.bind(Object(x.a)(n)),n}return Object(c.a)(a,[{key:"handleClick",value:function(){this.props.playTrack(this.props.previewURL)}},{key:"handleMouseHover",value:function(){this.setState(this.toggleHoverState)}},{key:"toggleHoverState",value:function(e){return{isHovering:!e.isHovering}}},{key:"render",value:function(){var e=this,t=this.props,a=(t.type,t.position),n=t.title,i=t.subtitle,s=t.percentage,o=(t.searchTerm,t.image),c=t.isPlaying,l=o?{backgroundImage:"url(".concat(o,")")}:{backgroundColor:"black"},u=r.a.createElement(g.a,null,r.a.createElement("span",{className:"order-number"},a),r.a.createElement("div",{className:"result-info"},r.a.createElement("span",{className:"result-summary"},r.a.createElement("span",{className:"result-danceability"},s," danceable"),r.a.createElement("span",{className:"result-name",alt:"View on Spotify"},n),r.a.createElement("span",{className:"result-artist",alt:"View on Spotify"},i)))),p=r.a.createElement("div",{className:"wrapper-artwork"},c?r.a.createElement("svg",{className:"icon-pause",onClick:function(){return e.handleClick()},width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("circle",{cx:"12",cy:"12",r:"11.5",fill:"black",stroke:"white"}),r.a.createElement("path",{d:"M11 16.5H8.75V7.5H11V16.5Z",fill:"white"}),r.a.createElement("path",{d:"M15.5 16.5H13.25V7.5H15.5V16.5Z",fill:"white"})):r.a.createElement("span",null),r.a.createElement("svg",{className:"icon-play",onClick:function(){return e.handleClick()},width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("circle",{cx:"12",cy:"12",r:"11.5",fill:"black",stroke:"white"}),r.a.createElement("path",{d:"M17 12L9.5 16.3301L9.5 7.66987L17 12Z",fill:"white"})),r.a.createElement("span",{className:"result-cover",style:l}));return r.a.createElement("div",{className:"wrapper",id:"result-item"},r.a.createElement("div",{className:"result-item",onMouseEnter:this.handleMouseHover,onMouseLeave:this.handleMouseHover},r.a.createElement("a",{className:"result-track",href:this.props.uri,rel:"noopener noreferrer",target:"_blank"},u),p))}}]),a}(r.a.Component)),S=function(){function e(t){Object(o.a)(this,e),this.token=t}return Object(c.a)(e,[{key:"addItemsToPlaylist",value:function(){var e=Object(w.a)(E.a.mark((function e(t,a){var n,r,i;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="\thttps://api.spotify.com/v1/playlists/".concat(t,"/tracks"),r={uris:a},i={headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.token)}},e.next=5,j.a.post(n,r,i);case 5:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"createPlaylist",value:function(){var e=Object(w.a)(E.a.mark((function e(t,a,n){var r,i,s,o,c,l=arguments;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(l.length>3&&void 0!==l[3])||l[3],i="https://api.spotify.com/v1/users/".concat(t,"/playlists"),s={name:a,description:n,public:r},o={headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.token)}},e.next=6,j.a.post(i,s,o);case 6:return c=e.sent,e.abrupt("return",c.data.id);case 8:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"getUserID",value:function(){var e=Object(w.a)(E.a.mark((function e(){var t;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://api.spotify.com/v1/me",e.next=3,j.a.get("https://api.spotify.com/v1/me",{headers:{Authorization:"Bearer ".concat(this.token)}});case 3:return t=e.sent,e.abrupt("return",t.data.id);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getUserFavorites",value:function(){var e=Object(w.a)(E.a.mark((function e(t,a){var n,r,i,s=arguments;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>2&&void 0!==s[2]?s[2]:20,r="https://api.spotify.com/v1/me/top/".concat(t),e.next=4,j.a.get(r,{headers:{Authorization:"Bearer ".concat(this.token)},params:{time_range:a,limit:n}});case 4:return i=e.sent,e.abrupt("return",i.data.items);case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"searchForPlaylist",value:function(){var e=Object(w.a)(E.a.mark((function e(t,a){var n,r;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://api.spotify.com/v1/search",e.next=3,j.a.get("https://api.spotify.com/v1/search",{headers:{Authorization:"Bearer ".concat(this.token)},params:{q:t.join("%20"),type:"playlist",limit:"10"}});case 3:return n=e.sent,r=n.data.playlists.items.filter((function(e){var n=!0;return t.forEach((function(t){n=n&&e.name.toLowerCase().includes(t.toLowerCase())})),n&&e.owner.display_name.toLowerCase().includes(a.toLowerCase())})),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getPlaylist",value:function(){var e=Object(w.a)(E.a.mark((function e(t){var a;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://api.spotify.com/v1/playlists/",e.next=3,j.a.get("".concat("https://api.spotify.com/v1/playlists/").concat(t),{headers:{Authorization:"Bearer ".concat(this.token)},params:{fields:"name,tracks.items(track)"}});case 3:return a=e.sent,e.abrupt("return",{name:a.data.name,tracks:a.data.tracks.items});case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRecentTracks",value:function(){var e=Object(w.a)(E.a.mark((function e(){var t;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://api.spotify.com/v1/me/player/recently-played",e.next=3,j.a.get("https://api.spotify.com/v1/me/player/recently-played",{headers:{Authorization:"Bearer ".concat(this.token)},params:{limit:50}});case 3:return t=e.sent,e.abrupt("return",t.data.items);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getTrackFeatures",value:function(){var e=Object(w.a)(E.a.mark((function e(t,a){var n,r,i;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],t.forEach((function(e){e.track?n.push(e.track.id):n.push(e.id)})),"https://api.spotify.com/v1/audio-features",e.next=5,j.a.get("https://api.spotify.com/v1/audio-features",{headers:{Authorization:"Bearer ".concat(this.token)},params:{ids:n.join()}});case 5:return r=e.sent,i=[],r.data.audio_features.forEach((function(e){if(!e)return null;var n={};a.forEach((function(a){if("popularity"===a){var r=t.find((function(t){return(t.track?t.track.id:t.id)===e.id}));n[a]=r.track?r.track.popularity:r.popularity}else e&&Object.keys(e).includes(a)&&(n[a]=e[a])})),i.push(n)})),e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()}]),e}(),_=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={buttonCopy:"Get Meddy With It",currentlyPlaying:"",finalPercentages:[],index:0,isLoading:!0,label:"Enter a song URI to start getting Meddy with it:",moreDanceableRecommendations:[],recommendationsPresent:!1,resultsTableHeading:"",seed_artists:"3faEZMpTmZFXpELU1EwWNL",seed_genres:"renaissance%2C%20medieval%2C%20baroque",seed_tracks:"5zBEauh8r5N1nroTKIBtdH",showValidation:"",targetTrackDanceability:"",userInput:[],userTrack:{},userTrackDanceability:""},n.getTrackFeatures=n.getTrackFeatures.bind(Object(x.a)(n)),n.handleChange=n.handleChange.bind(Object(x.a)(n)),n.playTrack=n.playTrack.bind(Object(x.a)(n)),n.resetMedifyer=n.resetMedifyer.bind(Object(x.a)(n)),n.showNextRecommendation=n.showNextRecommendation.bind(Object(x.a)(n)),n.showValidationError=n.showValidationError.bind(Object(x.a)(n)),n}return Object(c.a)(a,[{key:"getTrackFeatures",value:function(){var e=Object(w.a)(E.a.mark((function e(t){var a,n,r,i,s,o,c,l,u,p,m,d,h,f,y,v,g,k,b,w,x;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),a="https://api.spotify.com/v1/audio-features","https://api.spotify.com/v1/tracks/",n="https://api.spotify.com/v1/recommendations",r=this.state.seed_artists,i=this.state.seed_genres,s=this.state.seed_tracks,o=/[\w\:]*\:(\w+)/,c=this.state.userInput,!(o.test(c)&&c.length>1)){e.next=53;break}return this.setState({userInput:this.state.userInput}),l=this.state.userInput.match(/[\w\:]*\:(\w+)/)[1],this.setState({moreDanceableRecommendations:[],showValidation:""}),e.next=15,j.a.get("".concat("https://api.spotify.com/v1/tracks/").concat(l),{headers:{Authorization:"Bearer ".concat(this.props.token)}});case 15:return u=e.sent,this.setState({userTrack:u}),e.next=19,j.a.get("".concat(a,"?ids=").concat(l),{headers:{Authorization:"Bearer ".concat(this.props.token)}});case 19:return p=e.sent,m=p.data.audio_features[0].danceability,d=m+.05,this.setState({userTrackDanceability:(100*m).toFixed()+"%"}),e.next=25,j.a.get("".concat(n,"?seed_artists=").concat(r,"&seed_genres=").concat(i,"&seed_tracks=").concat(s,"&min_danceability=").concat(m,"&target_danceability=").concat(d),{headers:{Authorization:"Bearer ".concat(this.props.token)}});case 25:if(h=e.sent,f=[],h.data.tracks.forEach((function(e){e.preview_url&&f.push(e)})),!(f&&f.length>1)){e.next=40;break}return this.setState({moreDanceableRecommendations:f}),y=[],this.state.moreDanceableRecommendations.forEach((function(e){y.push(e.id)})),e.next=34,j.a.get(a,{headers:{Authorization:"Bearer ".concat(this.props.token)},params:{ids:y.join()}});case 34:v=e.sent,g=[],v.data.audio_features.forEach((function(e){g.push((100*e.danceability).toFixed()+"%")})),this.setState({finalPercentages:g,resultsTableHeading:"Your medieval equivalent:",userInput:[],buttonCopy:"Try another track URI",recommendationsPresent:!0,showValidation:""}),e.next=51;break;case 40:return e.next=42,j.a.get("".concat(n,"?seed_artists=").concat(r,"&seed_genres=").concat(i,"&seed_tracks=").concat(s,"&min_danceability=0.65"),{headers:{Authorization:"Bearer ".concat(this.props.token)}});case 42:return k=e.sent,b=[],k.data.tracks.forEach((function(e){b.push(e.id)})),e.next=47,j.a.get(a,{headers:{Authorization:"Bearer ".concat(this.props.token)},params:{ids:b.join()}});case 47:w=e.sent,x=[],w.data.audio_features.forEach((function(e){x.push((100*e.danceability).toFixed()+"%")})),this.setState({finalPercentages:x,moreDanceableRecommendations:k.data.tracks,resultsTableHeading:"OK, this is embarrassing, but it seems you\u2019ve found the limits of medieval-ness. Here are some things which are kinda close:",userInput:[],buttonCopy:"Try another track URI",recommendationsPresent:!0,showValidation:""});case 51:e.next=54;break;case 53:this.state.moreDanceableRecommendations.length>1?this.resetMedifyer():o.test(c)||this.showValidationError();case 54:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleChange",value:function(e){this.setState({userInput:e.target.value})}},{key:"showValidationError",value:function(){this.setState({userInput:[],showValidation:"That doesn't seem to be a valid track URI.",moreDanceableRecommendations:[],userTrack:{},userTrackDanceability:"",recommendationsPresent:!1,buttonCopy:"Try another track URI"})}},{key:"showNextRecommendation",value:function(e){e.preventDefault();var t=++this.state.index%this.state.moreDanceableRecommendations.length;if(this.setState({index:t}),document.getElementById("player")){var a=document.getElementById("player");this.playTrack(a)}}},{key:"resetMedifyer",value:function(){if(this.setState({userInput:[],showValidation:"",moreDanceableRecommendations:[],userTrack:{},userTrackDanceability:"",recommendationsPresent:!1,buttonCopy:"Get Meddy With It"}),document.getElementById("player")){var e=document.getElementById("player");this.playTrack(e)}}},{key:"playTrack",value:function(e){var t=this,a=document.getElementById("player");a?(a.paused?(a.play(),this.setState({currentlyPlaying:e})):(a.pause(),this.setState({currentlyPlaying:""})),a.src!==e&&(a.currentTime=0,a.src=e,a.play(),this.setState({currentlyPlaying:e}))):((a=new Audio(e)).setAttribute("id","player"),a.onended=function(){return t.setState({currentlyPlaying:""})},a.volume=1,document.getElementById("result-item").append(a),a.play(),this.setState({currentlyPlaying:e}))}},{key:"componentDidMount",value:function(){var e=Object(w.a)(E.a.mark((function e(){var t,a;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=new S(this.props.token),a=["acousticness","danceability","energy","instrumentalness","liveness","speechiness","valence","popularity"],e.next=5,t.getTrackFeatures(a);case 5:e.sent,this.setState({isLoading:!1}),this.props.load(),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0),e.t0.response&&401===e.t0.response.status&&this.props.handleTimeout();case 14:this.uriInput.focus();case 15:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"render",value:function(){var e,t=this,a=(this.state.moreDanceableRecommendations&&this.state.moreDanceableRecommendations.length,this.state.showValidation,this.state.userTrack.data||{}||{}),n=this.state.recommendationsPresent;return e=(this.state.moreDanceableRecommendations||{}||{}).map((function(e,a){return r.a.createElement(N,{type:"result-track",key:a.id,title:e.name,subtitle:e.artists[0].name,image:void 0===e.album.images[0]?null:e.album.images[0].url,previewURL:e.preview_url,uri:e.external_urls.spotify,playTrack:t.playTrack,isPlaying:t.state.currentlyPlaying===e.preview_url,percentage:t.state.finalPercentages[a]})})),this.state.isLoading?null:r.a.createElement("div",null,r.a.createElement(y.a,{fluid:!0,className:"mb-4 mt-2 header"},r.a.createElement("picture",null,r.a.createElement("source",{srcSet:"".concat(L.a," 1x"),media:"(max-width: 768px)"}),r.a.createElement("img",{className:"logo",srcSet:"".concat(C.a," 2x"),alt:"Full Logo"}))),r.a.createElement(y.a,{fluid:!0,className:"mb-4 mt-2"},r.a.createElement("p",null,"Give ",r.a.createElement("i",null,"Medifye")," any track on Spotify, and it will recommend a medieval* equivalent which is more danceable. Even if your favourite tune is ",r.a.createElement("i",null,"Sandstorm")," by Darude.")),r.a.createElement("div",{className:"container-fluid container-flex"},r.a.createElement("div",{className:"container-left"},n?r.a.createElement("div",null,"You've Medifyed this track:"):r.a.createElement("span",null),r.a.createElement("form",{onSubmit:this.getTrackFeatures,name:"uriForm",id:"URI"},n?r.a.createElement("div",{className:"test"}):r.a.createElement("div",{className:"inputDiv"},r.a.createElement("label",null,"Enter a Spotify track URI:"),r.a.createElement("input",{type:"text",className:"uriInput",name:"uriInput",value:this.state.userInput,onChange:function(e){return t.handleChange(e)},ref:function(e){t.uriInput=e},onKeyDown:function(e){"Enter"===e.key&&console.log("do validate")}}),r.a.createElement("div",{className:"validation"},this.state.showValidation),r.a.createElement("input",{type:"submit",className:"button-primary",value:this.state.buttonCopy}))),n?r.a.createElement("div",null):r.a.createElement("div",{className:"helper"},'You can copy a track URI by right-clicking any track and tapping "share"'),this.state.userTrack.data?r.a.createElement(N,{type:"track",key:a.id,title:a.name,subtitle:a.artists[0].name,image:void 0===a.album.images[0]?null:a.album.images[0].url,previewURL:a.preview_url,uri:a.external_urls.spotify,playTrack:this.playTrack,isPlaying:this.state.currentlyPlaying===a.preview_url,percentage:this.state.userTrackDanceability}):r.a.createElement("div",null)),r.a.createElement("div",{className:"container-right"},n?r.a.createElement("div",null,this.state.resultsTableHeading):r.a.createElement("div",null),e[this.state.index],n?r.a.createElement("form",{name:"resetForm"},r.a.createElement("input",{type:"submit",onClick:this.showNextRecommendation,className:"button-primary",value:"Show me another"}),r.a.createElement("input",{type:"submit",onClick:this.resetMedifyer,className:"button-secondary",value:"Start again"})):r.a.createElement("div",null))))}}]),a}(n.Component),R=a(32),D=a.n(R);function P(){return r.a.createElement("div",{style:{height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},r.a.createElement(g.a,null,r.a.createElement("img",{src:D.a,style:{maxHeight:"40vh",maxWidth:"80vw"},alt:"loading animation"}),r.a.createElement("span",null,"https://giphy.com/kiszkiloszki"),r.a.createElement("h1",null,"Getting ready to Meddy...")))}function M(){return r.a.createElement("footer",{className:"container-fluid mt-2 mb-4"},r.a.createElement("h6",null,"Built by"," ",r.a.createElement("a",{href:"http://lizmowforth.com/",target:"_blank"}," ","Liz Mowforth")," ","using React and the Spotify API."))}var B=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={isLoading:!0,childComponentIsLoading:!0},n}return Object(c.a)(a,[{key:"updateLoadingStatus",value:function(){this.state.childComponentIsLoading||this.setState({isLoading:!1})}},{key:"loadDashboard",value:function(){this.setState({childComponentIsLoading:!1}),this.updateLoadingStatus()}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,this.state.isLoading&&r.a.createElement(P,null),r.a.createElement(y.a,{fluid:"lg"},r.a.createElement(_,{token:this.props.token,load:function(){return e.loadDashboard()},handleTimeout:function(){return e.props.handleTimeout()}}),r.a.createElement(M,null)))}}]),a}(r.a.Component),z=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={isLoggedIn:!1,token:null},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=p.access_token;e&&this.setState({token:e})}},{key:"handleLogin",value:function(){window.location.replace(m),this.setState({isLoggedIn:!0})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"App"},!this.state.token&&r.a.createElement(k,{isLoggedIn:this.state.isLoggedIn,handleLogin:function(){return e.handleLogin()}}),this.state.token&&r.a.createElement(B,{token:this.state.token,handleTimeout:function(){return e.handleLogin()}}))}}]),a}(r.a.Component);s.a.render(r.a.createElement(z,null),document.getElementById("root"))}},[[34,1,2]]]);
//# sourceMappingURL=main.6a511421.chunk.js.map